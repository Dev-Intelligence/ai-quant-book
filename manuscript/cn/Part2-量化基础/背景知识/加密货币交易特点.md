# 背景知识：加密货币交易特点

> 加密货币市场与传统金融市场有显著差异。理解这些特点是开发加密货币量化策略的前提。

---

## 一、市场特点概览

| 特点 | 加密货币 | 传统股票 |
|-----|---------|---------|
| 交易时间 | 24/7/365 | 工作日固定时段 |
| 波动率 | 高（日波动通常 2-8%，极端时可达 20%+） | 较低（日波动 0.5-2%） |
| 监管 | 弱/混乱 | 严格 |
| 做空 | 容易（永续合约） | 需要融券 |
| 杠杆 | 高达 125x | 通常 2-4x |
| 市场效率 | 低（套利机会多） | 高 |

---

## 二、24/7 交易的影响

### 2.1 优势

- **无隔夜风险定义**：没有传统意义的"隔夜"
- **即时反应**：新闻发布后可立即交易
- **更多机会**：时间长 = 机会多

### 2.2 挑战

- **永无休止**：无法完全离开市场
- **流动性波动**：亚洲、欧洲、美洲时段流动性差异大
- **运维压力**：系统需要 24/7 在线

### 2.3 流动性时段分布

```
UTC 时间    主导市场    流动性
00:00-08:00  亚洲       中
08:00-16:00  欧洲       高
16:00-24:00  美洲       最高
周末         -          低
```

**策略建议**：
```python
def get_liquidity_multiplier(hour_utc, is_weekend):
    if is_weekend:
        return 0.5  # 周末流动性减半
    if 16 <= hour_utc < 24:
        return 1.2  # 美盘时段最佳
    elif 8 <= hour_utc < 16:
        return 1.0  # 欧盘时段正常
    else:
        return 0.7  # 亚盘时段较低
```

---

## 三、波动率特性

### 3.1 极端波动

| 事件 | 时间 | 波动 |
|-----|------|-----|
| 312 事件 | 2020.3.12 | BTC 单日 -50% |
| 519 事件 | 2021.5.19 | BTC 单日 -30% |
| FTX 崩溃 | 2022.11 | BTC 周跌 -25% |
| ETF 上市 | 2024.1 | BTC 周涨 +20% |

### 3.2 波动率建模

传统 GARCH 模型需要调整：
```python
# 加密货币波动率估算需要更短窗口
def crypto_volatility(returns, window=24):  # 24小时窗口
    return returns.rolling(window).std() * np.sqrt(365 * 24)  # 年化
```

### 3.3 对策略的影响

| 策略类型 | 影响 | 应对 |
|---------|------|-----|
| 趋势跟随 | 信号频繁 | 加大过滤阈值 |
| 均值回归 | 止损频繁 | 放宽止损范围 |
| 网格交易 | 适合 | 主流策略 |
| 套利 | 机会多 | 需要低延迟 |

---

## 四、交易所生态

### 4.1 主流交易所

| 交易所 | 类型 | 特点 | API 质量 |
|-------|------|-----|---------|
| Binance | CEX | 最大流动性 | ⭐⭐⭐⭐⭐ |
| OKX | CEX | 衍生品强 | ⭐⭐⭐⭐ |
| Bybit | CEX | 合约为主 | ⭐⭐⭐⭐ |
| Coinbase | CEX | 合规性好 | ⭐⭐⭐ |
| dYdX | DEX | 去中心化衍生品 | ⭐⭐⭐ |
| Uniswap | DEX | AMM 模式 | ⭐⭐⭐ |

### 4.2 交易所风险

- **交易所跑路**：FTX、Mt.Gox 等案例
- **API 不稳定**：高波动时 API 可能宕机
- **规则变更**：杠杆限制、手续费调整
- **提现限制**：可能冻结资金

**应对**：
- 资金分散在多个交易所
- 不在交易所存放过多资金
- 使用信誉好的大型交易所

---

## 五、衍生品市场

### 5.1 永续合约

**特点**：
- 无到期日
- 资金费率机制
- 高杠杆（最高 125x）

**资金费率**：
```
资金费率 > 0 → 多头付费给空头 → 市场偏多
资金费率 < 0 → 空头付费给多头 → 市场偏空

资金费率策略：
- 做空高正费率合约 + 现货对冲 = 赚取费率
```

### 5.2 交割合约

- 有到期日（周、月、季度）
- 期现价差存在套利机会

### 5.3 期权

- 发展较晚
- 主要在 Deribit、OKX
- 隐含波动率极高

---

## 六、DeFi 量化

### 6.1 AMM 机制

**Uniswap 公式**：
```
x * y = k

x = Token A 数量
y = Token B 数量
k = 常数

价格 = y / x
```

**滑点计算**：
```python
def calculate_amm_slippage(amount_in, reserve_in, reserve_out, fee=0.003):
    amount_with_fee = amount_in * (1 - fee)
    amount_out = (reserve_out * amount_with_fee) / (reserve_in + amount_with_fee)

    spot_price = reserve_out / reserve_in
    actual_price = amount_out / amount_in
    slippage = (spot_price - actual_price) / spot_price

    return slippage
```

### 6.2 DeFi 策略

| 策略 | 风险 | 收益来源 |
|-----|------|---------|
| 流动性挖矿 | 无常损失 | 交易费 + 代币激励 |
| 套利 | 智能合约风险 | 价格差异 |
| 借贷套利 | 清算风险 | 利率差 |
| MEV | 技术门槛高 | 抢先交易 |

### 6.3 智能合约风险

- 代码漏洞
- 闪电贷攻击
- 预言机操纵
- Rug Pull

---

## 七、数据特点

### 7.1 数据来源

| 来源 | 数据类型 | 特点 |
|-----|---------|-----|
| 交易所 API | 行情、交易 | 实时、免费 |
| CoinGecko | 聚合数据 | 覆盖广 |
| Glassnode | 链上数据 | 付费、深度 |
| Nansen | 钱包分析 | 付费、高端 |

### 7.2 链上数据

独特的数据源：
- 钱包余额变化
- 大户转账
- 交易所净流入/流出
- 活跃地址数
- 哈希率（PoW）
- 质押量（PoS）

```python
# 链上信号示例
def on_chain_signal(exchange_netflow, large_tx_count):
    """
    exchange_netflow > 0 → 资金流入交易所 → 可能抛压
    large_tx_count 上升 → 大户活跃 → 可能有方向性
    """
    if exchange_netflow > threshold_high:
        return -1  # 看空
    elif exchange_netflow < threshold_low:
        return 1   # 看多
    return 0
```

---

## 八、量化策略适配

### 8.1 高频策略

**挑战**：
- 延迟：交易所 API 延迟 10-100ms
- 竞争：专业做市商
- 成本：手续费吃掉利润

**建议**：除非有基础设施优势，否则不建议

### 8.2 中低频策略

**适合**：
- 趋势跟随（1小时-日线）
- 动量策略
- 资金费率套利
- 期现套利

**示例：资金费率套利**
```python
def funding_rate_arbitrage(funding_rate, threshold=0.0003):
    """
    当资金费率 > 0.03%（每8小时）时考虑套利

    注意：资金费率通常在 -0.03% 到 +0.03% 之间
    极端情况（如 2021 年牛市）可达 0.1% - 1%

    策略：
    1. 做空永续合约
    2. 做多现货对冲
    3. 每 8 小时收取资金费率
    """
    if funding_rate > threshold:
        gross_apr = funding_rate * 3 * 365  # 年化毛收益
        # 实际需扣除：交易手续费、借币利息、价差成本（约30-50%）
        return {
            'perp': 'SHORT',
            'spot': 'LONG',
            'gross_apr': f'{gross_apr:.1%}',
            'note': '需扣除手续费、借币成本、价差等'
        }
    return None
```

> **典型费率范围**：正常市场 ±0.01%/8h；多头拥挤时 0.05-0.1%/8h；极端情况 >0.3%/8h。

### 8.3 网格策略

**特点**：
- 在价格区间内设置多个买卖单
- 利用波动赚取价差
- 适合震荡市场

**示例**：
```python
def create_grid(lower, upper, grids, total_amount):
    grid_size = (upper - lower) / grids
    order_amount = total_amount / grids

    orders = []
    for i in range(grids):
        price = lower + i * grid_size
        orders.append({
            'price': price,
            'amount': order_amount,
            'side': 'BUY'
        })
        orders.append({
            'price': price + grid_size,
            'amount': order_amount,
            'side': 'SELL'
        })
    return orders
```

---

## 九、风险管理

### 9.1 特殊风险

| 风险 | 描述 | 应对 |
|-----|------|-----|
| 交易所风险 | 交易所倒闭/被黑 | 分散资金 |
| 极端波动 | 单日 50%+ 波动 | 降低杠杆 |
| 流动性枯竭 | 极端行情无法成交 | 预留缓冲 |
| 监管风险 | 政策突变 | 关注新闻 |
| 操纵风险 | 庄家控盘 | 选择主流币 |

### 9.2 杠杆建议

| 经验水平 | 建议杠杆 |
|---------|---------|
| 新手 | 1x（不用杠杆） |
| 有经验 | 2-3x |
| 专业 | 5-10x |
| 绝不建议 | > 20x |

### 9.3 风控代码

```python
class CryptoRiskManager:
    def __init__(self):
        self.max_position_pct = 0.1   # 单一持仓不超过 10%
        self.max_leverage = 3         # 最大杠杆
        self.max_daily_loss = 0.05    # 日最大亏损 5%
        self.stop_loss = 0.02         # 单笔止损 2%

    def check_order(self, order, portfolio):
        # 检查仓位限制
        if order.value / portfolio.total > self.max_position_pct:
            return False, "超过单一持仓限制"

        # 检查杠杆
        if order.leverage > self.max_leverage:
            return False, "超过杠杆限制"

        # 检查日亏损
        if portfolio.daily_pnl < -self.max_daily_loss:
            return False, "已达到日亏损限制"

        return True, "通过"
```

---

## 十、实践建议

### 10.1 入门路径

1. **学习基础**：理解区块链、钱包、交易所
2. **小额实践**：用小资金熟悉交易流程
3. **回测验证**：用历史数据验证策略
4. **模拟交易**：用测试网或模拟盘
5. **小额实盘**：逐步增加资金

### 10.2 工具推荐

| 用途 | 工具 |
|-----|------|
| API 封装 | CCXT（统一接口） |
| 回测 | Freqtrade, VectorBT |
| 数据 | CoinGecko API, Binance API |
| 链上分析 | Glassnode, Dune Analytics |

### 10.3 避坑指南

1. **不要用高杠杆**：血的教训太多
2. **不要追涨杀跌**：波动大不代表机会多
3. **不要忽视手续费**：高频交易成本累积快
4. **不要 All In**：分散投资，控制仓位
5. **不要忽视安全**：私钥、API 密钥保管好

---

> **核心原则**：加密货币市场波动大、机会多，但风险也大。保守的仓位管理和严格的风控是生存的关键。活得久比赚得多更重要。
